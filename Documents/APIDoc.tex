%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 数据结构大作业 Yrarbil API 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Version 0.1.0.0-base
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%确定该文档
\def\apidPart{}
%%%%%%
%% 版本
%%%%%%
\def\apiver{0.1.0.0-base}

%%%%%%
% flag 设置
%%%%%%
\makeatletter
\def\@NoStyleChapter{} % 设置不适用章节格式
\def\@apiPart{} % 设置当前为 api 部分
\def\@APIVersionFlag{}
\def\@RequestArgColor{\relax}
\def\@UsingAppendix{}
\def\@FootnoteWithPage{}
\def\@lst@json@define{} %json
\makeatother

%使用 XeLaTeX 和 CTeX 套装 编译
\documentclass[UTF8]{ctexart}



\include{Author}
\include{Preamble}

\title{Yrarbil's API Document \thanks{version : \apiver}}

%%%%
%% API 常用
%%%%
\def\safe{[\textit{safe}]}
\def\GET{\textbf{GET}}
\def\POST{\textbf{POST}}
\def\bfJSON{\textbf{JSON}}
\def\viaurl#1{\item[访问URL] #1}
\def\viareq#1{\item[访问方式] #1}
\def\rtdata{\item[返回数据]}





\begin{document}
    \maketitle
    \newpage
    \include{PrjIntr}
    \pdfbookmark[1]{text}{anchor}
    \tableofcontents
    \newpage


    \section{API 改动说明}

    \subsection{API 0.0.0.0-dbtag}
    该 API 标志的，首先，意味着这个数据库可查询其中支持的各个 API 版本。其次，意味着这是一个标准
      \footnote{按照这个API 文档构件的后端。并且从理论上，非配套的前后端也可以交互。}
    后端。最后，一般前端是无法直接访问数据库的，然而后端是要访问数据库的。

    \subsection{API 0.0.0.0-betag}
    该 API 标志着可以通过特定方式查询后端与数据库支持的 API 的版本。这也是一个标准后端的应有的。

    \subsection{DEL 0.0.0.0-tag,0.0.0.0-B,0.0.1.0-base}
    重新 整理API。

    \section{API说明}
    本 API 文档是约束前后端的行为的文档。规定了前后端之间的行为规范。但值得注意的是，前后端不一定是满足这个文档的。当前的 API 版本是 \apiver 。
    \subsection{那些部分会遵循api}
    原则上来说，整个项目均会按照此 api 文档构建。但主要的是在数据库，后端，与前端部分支持。
    

    
    
    
    
    
    
    
    
    
    
    
    \section{数据库API}
    \apiversion{0.0.0.0-dstag}{版本检查}
    可查询表 versions 来确定 所需要的 api 对应的版本号是否支持。
    \begin{lstlisting}[language=SQL]
SELECT * FROM versions WHERE NOT vereq(ver,yourver);
    \end{lstlisting}
    其中 yourver 是指定的版本标号。
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    \section{后端API}
    后端 API 主要以 HTTP 请求为主。
    
    
    \subsection{未分类API}
    
    \apiversion{0.1.0.0-base}{访问“主页”}
    访问主页
    \footnote{http://hostname:port/}
    可以获取一些信息。
    \begin{description}
        \viaurl http://hostname:port/
        \viareq \GET
        \rtdata 标准 HTML 代码。
    \end{description}
    
    
    
    
    
    
    
    
    
    
    \subsection{用户认证API}
    
    
    
    
    
    
    
    
    
    
    
    \apiversion{0.1.0.0-base}{管理员登陆}
    \begin{description}
   
        \item[访问URL] http://hostname:port/b8ab91a6
        \footnote{
            \textbf{login} 英文单词 md5值是$b8abe8f5a587a4c69685b17a954f8a3f$，
            SHA256值是 
            $6c1420b8f3be7a61357ecc82a1c391dffe438930c103466b1660625e42ac91a6$。
        }
        [\textit{safe}]
        \footnote{\textit{\textbf{safe}} 是指安全添加的内容，例如可以是主机ip的sha256值。一个URL中的“safe”不一定相同。后同}/fc8252b7
        \footnote{
            \textbf{admin} 英文单词的
            md5值是 $456b7016a916a4b178dd72b947c152b7 $,
            SHA256 值是
            $fc8252c8dc55839967c58b9ad755a59b61b67c13227ddae4bd3f78a38bf394f7$。
        }
        [\textit{safe}]
        
        \item[请求方式] \textbf{POST}
        
        \reqargclr{用户ID}\label{par:id}
        \footnote{这个颜色的背景，表示HTTP请求参数，后同。}
        $$uid=[id]$$
        其中id为用户登录的id，不强制为数字。
        
        \reqargclr{密码}\label{par:key}
         $$key=[md5\, of\, password][safe]$$
         其中第一部分是密码的md5值。
         
        \item[返回数据]请求返回的数据是 \textbf{JSON} 数据。具体返回内容有：
        特定的临时ID密钥，用于简化之后操作的认证；
        时限，长度为小时，限定使用实现\footnote{可选，可无}。
         \\ 可能的返回数据：
        \begin{lstlisting}[language=JavaScript]
{
   "tidk":"************************",
   "time":24
}  
        \end{lstlisting}
        
        
    \end{description}
    
    
    
    
    
    
    

    \apiversion{0.0.1.0-base}{管理员退出}
    \begin{description}
        \item[访问URL] http://hostname:port/a050ba73
        \footnote{
            单词 \textbf{logout} 的
            MD5值是$a05080965b04f4d190bb94b552bea56c $,
            SHA256 值是
            $60b2a0ba73317dce9502417ce5bdb75d0a16067848647b9a5f5f4e040397b20f$。
        }
        [\textit{safe}]/fc8252b7[\textit{safe}]
        
        \item[请求方式] \textbf{POST}
        
        \reqargclr{用户ID}\label{par:logout:id}
        \footnote{这个请求与临时ID密钥为二选一。}
        $$uid=[id]$$
        其中id为用户登陆时的id，不强制为数字。
        
        \reqargclr{临时ID密钥}\label{par:logout:tidk}
        \footnote{用户ID，可使该用户对应的所有临时ID密钥下线。}
        $$tidk=[key]$$
        其中key是临时ID密钥。
        
        \item[返回数据] 返回数据将是 \bfJSON 数据。其中会包含成功与否的信息。
        \\可能返回的信息：
        \begin{lstlisting}[language=JavaScript]
{
    "status":"success",
    "logoutcount":2
}
        \end{lstlisting}\label{par:logout:example}
        其中 \textbf{logoutcount} 是退出用户数量。
    \end{description}
    
    
    
    
    
    
    \apiversion{0.0.1.0-base}{读者登录}
		用于读者的登录。
		\begin{description}
            
		\item[访问URL] http://hostname:port/5ece85ba
        \footnote{单词 \textbf{reader} 的
            MD5 值是 
            $5ece7ae3f6950b744840b1d4c42e3a8e$，
            SHA256 值是
            $cd546fe85ba55d958a7fd1b2733f6f8f1ba5e4e099ddf0aad80b6d770b2eed9e$。
            }
        \safe/fc8252b7\safe
        
        \item[请求方式] \POST
        
        \reqargclr{用户ID} 参见 \ref{par:id}。
        \reqargclr{密码} 参见 \ref{par:key}。
        \item[返回数据] 返回的数据将是 \bfJSON 数据。返回的内容中包括临时ID密钥，与有效时间，以分钟计。
        \\可能返回的数据：
        \begin{lstlisting}[language=JavaScript]
{
    "tidk":"****************",
    "time":120
}
        \end{lstlisting}
		\end{description}
        
        
        
        
        
        \apiversion{0.0.1.0-base}{读者退出}
        \begin{description}
            \item[访问URL] http://hostname:port/5ece85ba\safe/fc8252b7\safe
            
            \item[请求方式] \POST
            
            \reqargclr{用户ID}
            参见 \ref{par:logout:id}。
            
            \reqargclr{临时ID密钥}
            参见 \ref{par:logout:tidk}。
            
            
            \item[返回数据] 返回数据将是 \bfJSON 数据。其中会包含成功与否的信息。
            \\可能返回的信息：
            \begin{lstlisting}[language=JavaScript]
{
    "status":"failure"
}
            \end{lstlisting}
            另外一个例子请参见 \ref{par:logout:example}。
        \end{description}
        
        
        
        
        
        
        
     
    \newpage
    \begin{appendices}
    \section{参考文档}
    \section{文档网址}
    todo 
    \end{appendices}
    
\end{document}
