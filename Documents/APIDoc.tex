%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% 数据结构大作业 Yrarbil API
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Version 0.1.0.0-base
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%确定该文档
\def\apidPart{}
%%%%%%
%% 版本
%%%%%%
\def\apiver{0.1.0.0-base}

%%%%%%
% flag 设置
%%%%%%
\makeatletter
\def\@NoStyleChapter{} % 设置不适用章节格式
\def\@apiPart{} % 设置当前为 api 部分
\def\@APIVersionFlag{}
\def\@RequestArgColor{\relax}
\def\@UsingAppendix{}
\def\@FootnoteWithPage{}
\def\@lst@json@define{} %json
\makeatother

%使用 XeLaTeX 和 XeCJK 套装 编译
\documentclass[UTF8]{article}
\usepackage{xeCJK}


\include{Author}
\include{Preamble}

\title{Yrarbil's API Document \thanks{version : \apiver}}

%%%%
%% API 常用
%%%%
\def\safe{[\textit{safe}]}
\def\GET{\textbf{GET}}
\def\POST{\textbf{POST}}
\def \itemPOST{\item[访问方式] \POST}
\def \itemGET{\item[访问方式] \GET}
\def\bfJSON{\textbf{JSON}}
\def\viaurl#1{\item[访问URL] #1}
\def\viareq#1{\item[访问方式] #1}
\def\rtdata{\item[返回数据]}





\begin{document}
    \maketitle
    \newpage
    \include{PrjIntr}
    \pdfbookmark[1]{text}{anchor}
    \tableofcontents
    \newpage


    \section{API 改动说明}

    \subsection{API 0.0.0.0-dbtag}
    该 API 标志的，首先，意味着这个数据库可查询其中支持的各个 API 版本。其次，意味着这是一个标准
      \footnote{按照这个API 文档构件的后端。并且从理论上，非配套的前后端也可以交互。}
    后端。最后，一般前端是无法直接访问数据库的，然而后端是要访问数据库的。

    \subsection{API 0.0.0.0-betag}
    该 API 标志着可以通过特定方式查询后端与数据库支持的 API 的版本。这也是一个标准后端的应有的。

    \subsection{DEL 0.0.0.0-tag,0.0.0.0-B,0.0.1.0-base}
    重新 整理API。

    \section{API说明}
    本 API 文档是约束前后端的行为的文档。规定了前后端之间的行为规范。但值得注意的是，前后端不一定是满足这个文档的。当前的 API 版本是 \apiver 。
    \subsection{那些部分会遵循api}
    原则上来说，整个项目均会按照此 api 文档构建。但主要的是在数据库，后端，与前端部分支持。













    \section{数据库API}
    \apiversion{0.0.0.0-dstag}{版本检查}
    可查询表 versions 来确定 所需要的 api 对应的版本号是否支持。
    \begin{lstlisting}[language=SQL]
SELECT * FROM versions WHERE NOT vereq(ver,yourver);
    \end{lstlisting}
    其中 yourver 是指定的版本标号。




















    \section{后端API}
    后端 API 主要以 HTTP 请求为主。


    \subsection{未分类API}

    \apiversion{0.1.0.0-base}{访问“主页”}
    访问主页
    \footnote{http://hostname:port/}
    可以获取一些信息。
    \begin{description}
        \viaurl http://hostname:port/
        \viareq \GET
        \rtdata 标准 HTML 代码。
    \end{description}

    \apiversion{0.0.1.0-base}{获得 api 版本}
    获得当前 api 版本支持。
    \begin{description}
		\item[访问 URL] http://hostname:port/version
		\itemGET
		\reqargclr{NoJSON 选项}
		$$nojson=[true|false]$$
		如果是 $true$ 那么则不返回 JSON 数据，默认是 $false$。
	\end{description}









    \subsection{用户认证API}











    \apiversion{0.1.0.0-base}{管理员登陆}
    \begin{description}

        \viaurl http://hostname:port/b8ab91a6
        \footnote{
            \textbf{login} 英文单词 md5值是$b8abe8f5a587a4c69685b17a954f8a3f$，
            SHA256值是
            $6c1420b8f3be7a61357ecc82a1c391dffe438930c103466b1660625e42ac91a6$。
        }
        \safe
        \footnote{\textit{\textbf{safe}} 是指安全添加的内容，例如可以是主机ip的sha256值。一个URL中的“safe”不一定相同。后同}/fc8252b7
        \footnote{
            \textbf{admin} 英文单词的
            md5值是 $456b7016a916a4b178dd72b947c152b7 $,
            SHA256 值是
            $fc8252c8dc55839967c58b9ad755a59b61b67c13227ddae4bd3f78a38bf394f7$。
        }
        \safe

        \viareq \POST

        \reqargclr{用户ID}\label{par:id}
        \footnote{这个颜色的背景，表示HTTP请求参数，后同。}
        $$uid=[id]$$
        其中id为用户登录的id，不强制为数字。

        \reqargclr{密码}\label{par:key}
         $$key=[md5\, of\, password][safe]$$
         其中第一部分是密码的md5值。

        \rtdata 请求返回的数据是 \bfJSON 数据。具体返回内容有：
        特定的临时ID密钥，用于简化之后操作的认证；
        时限，长度为小时，限定使用实现\footnote{可选，可无}。
         \\ 可能的返回数据：
        \begin{lstlisting}[language=JavaScript]
{
   "tidk":"************************",
   "time":24
}
        \end{lstlisting}


    \end{description}








    \apiversion{0.1.0.0-base}{管理员退出}
    \begin{description}
        \viaurl http://hostname:port/a050ba73
        \footnote{
            单词 \textbf{logout} 的
            MD5值是$a05080965b04f4d190bb94b552bea56c $,
            SHA256 值是
            $60b2a0ba73317dce9502417ce5bdb75d0a16067848647b9a5f5f4e040397b20f$。
        }
        \safe/fc8252b7\safe]

        \viareq \POST

        \reqargclr{用户ID}\label{par:logout:id}
        \footnote{这个请求与临时ID密钥为二选一。}
        $$uid=[id]$$
        其中id为用户登陆时的id，不强制为数字。

        \reqargclr{临时ID密钥}\label{par:logout:tidk}
        \footnote{用户ID，可使该用户对应的所有临时ID密钥下线。}
        $$tidk=[key]$$
        其中key是临时ID密钥。

        \rtdata 返回数据将是 \bfJSON 数据。其中会包含成功与否的信息。
        \\可能返回的信息：
        \begin{lstlisting}[language=JavaScript]
{
    "status":"success",
    "logoutcount":2
}
        \end{lstlisting}\label{par:logout:example}
        其中 \textbf{logoutcount} 是退出用户数量。
    \end{description}






    \apiversion{0.1.0.0-base}{读者登录}
		用于读者的登录。
		\begin{description}

		\viaurl http://hostname:port/5ece85ba
        \footnote{单词 \textbf{reader} 的
            MD5 值是
            $5ece7ae3f6950b744840b1d4c42e3a8e$，
            SHA256 值是
            $cd546fe85ba55d958a7fd1b2733f6f8f1ba5e4e099ddf0aad80b6d770b2eed9e$。
            }
        \safe/fc8252b7\safe

        \viareq \POST

        \reqargclr{用户ID} 参见 \ref{par:id}。
        \reqargclr{密码} 参见 \ref{par:key}。
        \rtdata 返回的数据将是 \bfJSON 数据。返回的内容中包括临时ID密钥，与有效时间，以分钟计。
        \\可能返回的数据：
        \begin{lstlisting}[language=JavaScript]
{
    "tidk":"****************",
    "time":120
}
        \end{lstlisting}
		\end{description}





        \apiversion{0.1.0.0-base}{读者退出}
        \begin{description}
            \viaurl http://hostname:port/5ece85ba\safe/fc8252b7\safe

            \viareq \POST

            \reqargclr{用户ID}
            参见 \ref{par:logout:id}。

            \reqargclr{临时ID密钥}
            参见 \ref{par:logout:tidk}。


            \rtdata 返回数据将是 \bfJSON 数据。其中会包含成功与否的信息。
            \\可能返回的信息：
            \begin{lstlisting}[language=JavaScript]
{
    "status":"failure"
}
            \end{lstlisting}
            另外一个例子请参见 \ref{par:logout:example}。
        \end{description}


        \subsection{图书借阅API}
        \footnote{借阅，归还，续借}
        \apiversion{0.1.0.0-base}{图书借阅}
        \apiversion{0.1.0.0-base}{图书归还}
        \apiversion{0.1.0.0-base}{图书续借}
        \apiversion{0.1.0.0-base}{超期处理}
        \apiversion{0.1.0.0-base}{处罚处理}%缴纳罚款
        \subsection{图书预约API}
        \apiversion{0.1.0.0-base}{图书预约}
        \apiversion{0.1.0.0-base}{图书预约取消}
        \subsection{图书信息查询}
        \apiversion{0.1.0.0-base}{图书状态查询}
        \apiversion{0.1.0.0-base}{图书CIP信息查询}
        \apiversion{0.1.0.0-base}{图书其他信息查询}
        \subsection{图书检索}
        \apiversion{0.1.0.0-base}{根据ISBN匹配}
        \apiversion{0.1.0.0-base}{密码}
        \subsection{图书录入与销毁}
        \apiversion{0.1.0.0-base}{图书录入}
        \apiversion{0.1.0.0-base}{图书销毁}





        \subsection{图书的生命周期部分}
        图书的生命周期包括被查询，被预约，借阅，续借，归还，和采购与销毁。






        \apiversion{0.0.1.0-base}{查询图书的 CIP 数据}
        通过 ISBN查询，返回图书的信息。
        \begin{description}

        	\item[访问 URL] http://hostname:port/
        	423472651c
        	\footnote{单词 \textbf{book}的
        		MD5 值是 $4f98663772651c870e911982e991d0d9$，
        		SHA256 值是
                $3c4dbff9eeda9410a0b9eb423472981db8997d666388b4cd2424700c3974d64b$
                。
        		}
	        \safe/9c4f7bfef
	        \footnote{
	        	单词 \textbf{search} 的
	        	MD5 值是 $9c4fc45b8e6ad4bf08f959548f52099e$，
	        	SHA256 值是
                $f1f3528bad895d7e9db4544081b531c2126781843aebafa6cbea7c2f9358cf85$
                。
	        	单词 \textbf{ISBN} 的
	        	MD5 值是 $f329188d04f7bd852894eed846386423$，
	        	SHA256 值是
                $3cb720e9f89bfef38a513b1ee0c47cc0ae75c3353612c3466761df19dc945f29$
                 。
	        	}
	        \safe


	        \item[请求方式] \GET


	        \reqargclr{ISBN码}
	        $$isbn=[ISBN]$$
	        其中的 ISBN 是书的 ISBN 码。


	        \reqargclr{返回数据形式}
	        $$type=[json|html]$$
	        返回的数据格式类型是 JSON 数据还是 HTML 文件。

	        \item[返回数据] 请求返回的可能是数据，也可能是 html。
	        可能返回的数据之一：
\begin{lstlisting}[language=JavaScript]
{
	"name":"the name of book",
	"author":"who write it!",
	"publishLocation":"Xi`an,China",
	"pressHouse":"ourPress",
	"publishDate":"1970-01-01",
	"ISBN":"ISBN978-7-302-22446-4",
	"location":"TP312"
}
\end{lstlisting}
	       或者会拿到 HTMl 代码:
\begin{lstlisting}[language=HTML]
<HTML>
	<body>
	<p> the name of book</p>
	<p> 'who write it' write this book </p>
	<p> 'our press' publish this book in Xi`an , China </p>
	<p> At Jan. 1st, 1970. </p>
	<p> ISBN is 978-7-302-22446-4</p>
	<p> You can find these books at TP312.</p>
	</body>
</HTML>
\end{lstlisting}
        \end{description}




        \apiversion{0.0.1.0-base}{x}






    \newpage
    \begin{appendices}
    \section{参考文档}
    \section{文档网址}
    todo
    \end{appendices}

\end{document}
